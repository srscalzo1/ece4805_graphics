<!DOCTYPE html>
<html>
<head>
    <title>Map Viewer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        var myMap;
        var movingMarker = null;
        var homeMarker = null;
        var index = 0;
        var coordinates = [
            [40.7128, -74.0060],
            [40.7138, -74.0050],
            [40.7148, -74.0040],
            [40.7158, -74.0030],
            [40.7168, -74.0020]
        ];

        var circleStyle = {
            color: 'green',
            fillColor: 'green',
            fillOpacity: 0.8,
            radius: 8, // Set the radius for the circle
        };

        var homeIcon = L.icon({
            iconUrl: 'icons/home-icon.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32]
        });

        function setMap() {
            myMap = L.map('map').setView([40.7128, -74.0060], 11);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(myMap);

            movingMarker = L.circleMarker(coordinates[0], circleStyle)
                .addTo(myMap);

            // 
            let mapUpdated = true
            // When map starts moving (user pans/zooms or setView/flyTo is called)
            myMap.on('movestart', function () {
                mapUpdated = false;
            });

            // When map finishes moving
            myMap.on('moveend', function () {
                mapUpdated = true;
            });

            setInterval(function () {
                if (!mapUpdated) return; // Avoid updating while map is unstable

                // Move marker here
                if (index >= coordinates.length) {
                    index = 0;
                }
                movingMarker.setLatLng(coordinates[index]);
                index++;
            }, 1000);
        }


        function updateMap(lat, lon) {
            if (myMap) {
                const center = myMap.getCenter();
                const zoom = myMap.getZoom();
                if (center.lat !== lat || center.lng !== lon || zoom !== 11) {
                    myMap.setView([lat, lon], 11);
                }
            }
        }

        function selectCoordinates(lat, lon) {
            coordinates.push([lat, lon]);

            // Remove existing home marker if it exists
            if (homeMarker) {
                myMap.removeLayer(homeMarker);
            }

            // Add new home marker with home icon
            homeMarker = L.marker([lat, lon], { icon: homeIcon })
                .addTo(myMap)

            updateMap(lat, lon);
        }

        function goHome(lat, lon) {
            updateMap(lat, lon);
        }

        window.onload = function () {
            setMap();
        };
    </script>

    <style>
        .crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 32px;
            height: 32px;
            margin-left: -16px;
            margin-top: -16px;
            background: url('https://cdn.iconscout.com/icon/free/png-256/crosshair-1781277-1518657.png') no-repeat center center;
            background-size: contain;
            z-index: 9999;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="map" style="width: 100%; height: 100vh;"></div>
</body>
</html>